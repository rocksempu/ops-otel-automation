{
  "title": "RUM Experience - ${service_name} [${environment}]",
  "uid": "${service_name}-rum",
  "tags": [
    "${service_namespace}",
    "${service_owner}",
    "${environment}",
    "RUM",
    "WebVitals",
    "generated-by-pipeline"
  ],
  "timezone": "browser",
  "schemaVersion": 30,
  "version": 0,
  "refresh": "30s",
  "templating": {
    "list": [
      {
        "name": "page",
        "label": "Page",
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "Prometheus" },
        "query": "label_values(rum_lcp_ms{service_name=\"${service_name}\"}, page)",
        "refresh": 2,
        "includeAll": true,
        "multi": true,
        "allValue": ".*"
      },
      {
        "name": "browser",
        "label": "Browser",
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "Prometheus" },
        "query": "label_values(rum_lcp_ms{service_name=\"${service_name}\", page=~\"$page\"}, browser)",
        "refresh": 2,
        "includeAll": true,
        "multi": true,
        "allValue": ".*"
      },
      {
        "name": "device",
        "label": "Device",
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "Prometheus" },
        "query": "label_values(rum_lcp_ms{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\"}, device)",
        "refresh": 2,
        "includeAll": true,
        "multi": true,
        "allValue": ".*"
      }
    ]
  },
  "panels": [
    {
      "id": 1,
      "title": "LCP pass rate (%)",
      "description": "Largest Contentful Paint < 2,5s",
      "type": "stat",
      "gridPos": { "h": 4, "w": 3, "x": 0, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        {
          "expr": "100 - 100 * (sum(sum_over_time((rum_lcp_ms{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\", device=~\"$device\"} <= 2500)[$__range:$__interval])) / sum(count_over_time(rum_lcp_ms{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\", device=~\"$device\"}[$__range:$__interval])))/10000",
          "legendFormat": "LCP pass %",
          "refId": "A"
        }
      ],
      "options": { "colorMode": "value", "graphMode": "area" },
      "fieldConfig": {
        "defaults": {
          "min": 0,
          "max": 100,
          "thresholds": { "steps": [{ "color": "green", "value": 0 }, { "color": "red", "value": 90 }] },
          "unit": "percent"
        }
      }
    },
    {
      "id": 2,
      "title": "INP pass rate (%)",
      "description": "Interaction to Next Paint",
      "type": "stat",
      "gridPos": { "h": 4, "w": 3, "x": 3, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        {
          "expr": "100 - 100 * sum(sum_over_time((rum_inp_ms{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\", device=~\"$device\"} <= 200)[$__range:$__interval])) / sum(count_over_time(rum_inp_ms{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\", device=~\"$device\"}[$__range:$__interval]))/1000",
          "legendFormat": "INP pass %",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "thresholds": { "steps": [{ "color": "green", "value": 0 }, { "color": "red", "value": 95 }] },
          "unit": "percent"
        }
      }
    },
    {
      "id": 3,
      "title": "CLS pass rate (%)",
      "description": "Cumulative Layout Shift",
      "type": "stat",
      "gridPos": { "h": 4, "w": 3, "x": 6, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        {
          "expr": "2000 * sum(sum_over_time((rum_cls{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\", device=~\"$device\"} <= 0.1)[$__range:$__interval])) / sum(count_over_time(rum_cls{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\", device=~\"$device\"}[$__range:$__interval]))",
          "legendFormat": "CLS pass %",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "thresholds": { "steps": [{ "color": "green", "value": 0 }, { "color": "red", "value": 97 }] },
          "unit": "percent"
        }
      }
    },
    {
      "id": 7,
      "title": "CLS por página",
      "type": "timeseries",
      "gridPos": { "h": 7, "w": 9, "x": 0, "y": 4 },
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        {
          "expr": "avg by (page) (rum_cls{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\", device=~\"$device\"})",
          "legendFormat": "{{page}}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 5,
      "title": "LCP por página",
      "type": "timeseries",
      "gridPos": { "h": 11, "w": 10, "x": 9, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        {
          "expr": "avg by (page) (rum_lcp_ms{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\", device=~\"$device\"})",
          "legendFormat": "{{page}}",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "ms" } }
    },
    {
      "id": 10,
      "title": "Média por Browser (LCP ms)",
      "type": "bargauge",
      "gridPos": { "h": 11, "w": 5, "x": 19, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        {
          "expr": "avg by (browser) (rum_lcp_ms{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\", device=~\"$device\"})",
          "legendFormat": "{{browser}}",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "ms" } }
    },
    {
      "id": 11,
      "title": "Traces - RUM",
      "type": "table",
      "gridPos": { "h": 7, "w": 19, "x": 0, "y": 11 },
      "datasource": { "type": "tempo", "uid": "Tempo" },
      "targets": [
        {
          "queryType": "traceqlSearch",
          "limit": 20,
          "tableType": "traces",
          "refId": "A",
          "filters": [
            { "id": "service-name", "scope": "resource", "tag": "service.name", "operator": "=", "value": ["${service_name}"], "valueType": "string" },
            { "id": "span-name", "scope": "span", "tag": "name", "operator": "=", "value": ["page_load"], "valueType": "string" }
          ]
        }
      ]
    },
    {
      "id": 12,
      "title": "APdex Score",
      "type": "stat",
      "gridPos": { "h": 7, "w": 5, "x": 19, "y": 11 },
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        {
          "expr": "(2000 * sum(sum_over_time((rum_cls{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\", device=~\"$device\"} <= 0.1)[$__range:$__interval])) / sum(count_over_time(rum_cls{service_name=\"${service_name}\", page=~\"$page\", browser=~\"$browser\", device=~\"$device\"}[$__range:$__interval])))/100",
          "legendFormat": "CLS pass %",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "thresholds": { "steps": [{ "color": "green", "value": 0 }, { "color": "red", "value": 97 }] }
        }
      }
    }
  ]
}